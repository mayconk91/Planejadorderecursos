<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Planejador de Recursos ‚Äî Offline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="container">
    <header class="topbar">
      <div>
        <h1>Planejador de Recursos ‚Äî Offline</h1>
        <p class="muted">
          Cadastro de recursos e atividades, timeline por recurso, filtros combinados, busca, indicadores de capacidade por dia e exporta√ß√µes (Excel/CSV) para Power BI. Hist√≥rico de altera√ß√µes com justificativa.
        </p>
      </div>
      
    </header>

  <nav class="tabs">
    <button class="tab active" data-tab="plan">Planejamento</button>
    <button class="tab" data-tab="exec">Vis√£o Executiva</button>
    <button class="tab" data-tab="avail">Disponibilidade</button>
    <button class="tab" data-tab="util">Exporta√ß√µes & Backup</button>
  </nav>

  <div id="tab-plan" class="tabpanel active">


    <section class="panel filters">
      <div class="group">
        <label>Status</label>
        <div class="chipset" id="statusChips"></div>
      </div>
      <div class="group">
        <label>Tipo</label>
        <select id="tipoSel">
          <option value="">Todos</option>
          <option>Interno</option>
          <option>Externo</option>
        </select>
      </div>
      <div class="group">
        <label>Senioridade</label>
        <select id="senioridadeSel">
          <option value="">Todas</option>
          <option>Jr</option>
          <option>Pl</option>
          <option>Sr</option>
          <option>NA</option>
        </select>
      </div>
      <div class="group grow">
        <label>Busca por t√≠tulo</label>
        <input id="buscaTitulo" placeholder="Digite parte do t√≠tulo da atividade" />
      </div>
      <div class="group">
        <label>Recurso</label>
        <input id="buscaRecurso" placeholder="Digite parte do nome do recurso" />
      </div>
      <div class="group">
        <label>In√≠cio (vis√£o)</label>
        <input id="inicioVisao" type="date" />
      </div>
      <div class="group">
        <label>Fim (vis√£o)</label>
        <input id="fimVisao" type="date" />
      </div>
    </section>

    <section class="panel">
      <div class="toolbar">
        <button id="btnNovoRecurso" class="btn primary">+ Recurso</button>
        <button id="btnNovaAtividade" class="btn">+ Atividade</button>
      </div>

      <div class="legend">
        <strong>Legenda:</strong>
        <span class="badge planned">Planejada</span>
        <span class="badge running">Em Execu√ß√£o</span>
        <span class="badge blocked">Bloqueada</span>
        <span class="badge done">Conclu√≠da</span>
        <span class="badge canceled">Cancelada</span>
        <span class="badge gap">Lacuna</span>
        <span class="badge heat">Heatmap capacidade (0‚Äì100% / &gt;100%)</span>
      </div>

      <div id="gantt" class="gantt"></div>
    </section>

    <section class="panel grid">
      <div>
        <h2>Recursos</h2>
        <table id="tblRecursos" class="tbl">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Tipo</th>
              <th>Senioridade</th>
              <th>Ativo</th>
              <th>Capacidade % (dia)</th>
              <th>In√≠cio ativo</th>
              <th>Fim ativo</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div>
        <h2>Atividades</h2>
        <table id="tblAtividades" class="tbl">
          <thead>
            <tr>
              <th>T√≠tulo</th>
              <th>Recurso</th>
              <th>In√≠cio</th>
              <th>Fim</th>
              <th>Status</th>
              <th>Aloca√ß√£o %</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="panel" id="aggPanel">
      <div class="toolbar">
        <strong>Capacidade agregada</strong>
        <label class="muted" style="margin-left:8px">Granularidade:</label>
        <select id="aggGran">
          <option value="weekly">Semanal</option>
          <option value="monthly">Mensal</option>
        </select>
      </div>
      <div id="aggCharts" class="agg-grid"></div>
    </section>

    </div>


    <div id="tab-exec" class="tabpanel">
      <section class="panel kpi" id="kpiPanel">
        <h2>Vis√£o Executiva</h2>
        <div class="kpi-grid">
          <div class="kpi-card"><span id="kpiExecucao">0%</span><label>% Execu√ß√£o</label></div>
          <div class="kpi-card"><span id="kpiRecursos">0</span><label>Recursos Ativos</label></div>
          <div class="kpi-card"><span id="kpiSobrecarga">0</span><label>Recursos Sobrecarregados</label></div>
        </div>
      </section>
      <section class="panel" id="exec-overload-panel">
        <div class="toolbar"><strong>Recursos Sobrecarregados ‚Äî Detalhes</strong></div>
        <div class="muted" id="overloadEmptyMsg">Nenhum recurso sobrecarregado no per√≠odo.</div>
        <div class="table-wrap" style="display:none" id="overloadDetailsWrap">
          <table class="table" id="overloadDetails">
            <thead>
              <tr>
                <th>Recurso</th>
                <th>Per√≠odo de Sobreposi√ß√£o</th>
                <th>Atividades concorrentes</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </div>


    
    <div id="tab-avail" class="tabpanel">
      <section class="panel">
        <h2>Verificar Disponibilidade por Capacidade</h2>
        <div class="filters" style="grid-template-columns: repeat(6, minmax(0,1fr));">
          <div class="group">
            <label>Dias necess√°rios</label>
            <input id="avDias" type="number" min="1" value="5"/>
          </div>
          <div class="group">
            <label>Dias √∫teis apenas?</label>
            <select id="avUteis">
              <option value="1">Sim</option>
              <option value="0">N√£o</option>
            </select>
          </div>
          <div class="group">
            <label>% capacidade requerida (dia)</label>
            <input id="avPerc" type="number" min="1" max="1000" value="25"/>
          </div>
          <div class="group">
            <label>Tipo</label>
            <select id="avTipo">
              <option value="">Todos</option>
              <option>Interno</option>
              <option>Externo</option>
            </select>
          </div>
          <div class="group">
            <label>Senioridade</label>
            <select id="avSenioridade">
              <option value="">Todas</option>
              <option>Jr</option>
              <option>Pl</option>
              <option>Sr</option>
              <option>NA</option>
            </select>
          </div>
          <div class="group">
            <label>Data de busca a partir de</label>
            <input id="avInicio" type="date"/>
          </div>
        </div>
        <div class="toolbar">
          <button id="avBtn" class="btn primary">Verificar disponibilidade</button>
        </div>
        <div id="avResultado" class="panel">
          <div class="muted">Informe os par√¢metros e clique em "Verificar disponibilidade".</div>
        </div>
      </section>
    </div>
    

  <div id="tab-util" class="tabpanel">
      <section class="panel">
        <h2>Exporta√ß√µes & Backup</h2>
        <div class="actions stack">
        <input id="currentUser" placeholder="Usu√°rio atual (opcional)" class="userbox" />
        <div class="inline-actions" id="bdControls">
          <!-- Bot√£o removido: a sele√ß√£o de pasta ser√° solicitada automaticamente quando necess√°rio -->
          <!-- Leitura: permite importar um BD (sem permiss√£o de escrita) via input de arquivo. -->
          <!-- Importar BD apenas para leitura. Use esta op√ß√£o se desejar apenas visualizar os dados sem gravar mudan√ßas no arquivo. -->
          <label class="btn">üìÑ Importar BD (somente leitura)
            <input id="fileBD" type="file" accept=".xls,.html,.csv" class="hidden" />
          </label>
          <!-- Selecionar BD com permiss√£o de leitura e grava√ß√£o. Esta √© a op√ß√£o recomendada para atualizar o arquivo em tempo real. -->
          <button id="btnPickBDFile" class="btn">üìÑ Selecionar BD (ler/gravar)</button>
          <button id="btnExportModeloXLS" class="btn">‚¨áÔ∏è Exportar modelo de BD (Excel)</button>
          <button id="btnExportModeloCSV" class="btn">‚¨áÔ∏è Exportar modelo de BD (CSV √∫nico)</button>
          <span id="bdStatus" class="muted"></span>
        </div>
        <button id="btnExportCSV" class="btn">Exportar CSV (Recursos/Atividades)</button>
        <button id="btnExportXLS" class="btn">Exportar Excel (XLS compat√≠vel)</button>
        <button id="btnExportPBI" class="btn">Exportar CSV Power BI (di√°rio)</button>
        <button id="btnHistAll" class="btn">Hist√≥rico (CSV consolidado)</button>
        <button id="btnBackup" class="btn">Backup (JSON)</button>
        <button id="btnExportPDF" class="btn primary">Exportar PDF (Vis√£o Geral)</button>
        <!-- Restaurar removido -->
        <!-- Pasta de dados controls removidos (incorporados no bloco BD) -->
      </div>
<p class="muted">Dica: para alimentar por planilha, use "Selecionar BD (ler/gravar)" e o "Modelo de BD (Excel/CSV)". Se voc√™ usar "Importar BD (somente leitura)", as altera√ß√µes n√£o ser√£o salvas no arquivo.</p>
      </section>
    </div>

  </div>

  <!-- Dialog Recurso -->
  <dialog id="dlgRecurso">
    <form method="dialog" id="formRecurso" class="form">
      <h3 id="dlgRecursoTitulo">Novo Recurso</h3>
      <input type="hidden" name="id" />
      <label>Nome <input name="nome" required /></label>
      <div class="grid2">
        <label>Tipo
          <select name="tipo">
            <option>Interno</option>
            <option>Externo</option>
          </select>
        </label>
        <label>Senioridade
          <select name="senioridade">
            <option>Jr</option>
            <option>Pl</option>
            <option>Sr</option>
            <option>NA</option>
          </select>
        </label>
      </div>
<div class="grid2">
        <label>Ativo <input type="checkbox" name="ativo" checked /></label>
        <label>Capacidade di√°ria (%) <input type="number" name="capacidade" min="1" max="1000" value="100" /></label>
      </div>
<div class="grid2">
        <label>In√≠cio ativo (opcional) <input type="date" name="inicioAtivo" /></label>
        <label>Fim ativo (opcional) <input type="date" name="fimAtivo" /></label>
      </div>
<menu>
        <button value="cancel">Cancelar</button>
        <button id="btnSalvarRecurso" value="save" class="primary">Salvar</button>
      </menu>
    </form>
  </dialog>

  <!-- Dialog Atividade -->
  <dialog id="dlgAtividade">
    <form method="dialog" id="formAtividade" class="form">
      <h3 id="dlgAtividadeTitulo">Nova Atividade</h3>
      <input type="hidden" name="id" />
      <label>T√≠tulo <input name="titulo" required /></label>
      <label>Recurso
        <select name="resourceId" required></select>
      </label>
      <div class="grid2">
        <label>In√≠cio <input type="date" name="inicio" required /></label>
        <label>Fim <input type="date" name="fim" required /></label>
      </div>
<div class="grid2">
        <label>Status
          <select name="status">
            <option>Planejada</option>
            <option>Em Execu√ß√£o</option>
            <option>Bloqueada</option>
            <option>Conclu√≠da</option>
            <option>Cancelada</option>
          </select>
        </label>
        <label>Aloca√ß√£o di√°ria (%) <input type="number" name="alocacao" min="1" max="1000" value="100" /></label>
      </div>
<menu>
        <button value="cancel">Cancelar</button>
        <button id="btnSalvarAtividade" value="save" class="primary">Salvar</button>
      </menu>
    </form>
  </dialog>

  <!-- Dialog Justificativa (altera√ß√£o de datas) -->
  <dialog id="dlgJust">
    <form method="dialog" id="formJust" class="form">
      <h3>Justificativa da altera√ß√£o de datas</h3>
      <p id="justResumo" class="muted"></p>
      <label>Justificativa
        <textarea name="just" required rows="4" placeholder="Descreva a raz√£o da altera√ß√£o de datas..."></textarea>
      </label>
      <menu>
        <button value="cancel">Cancelar</button>
        <button id="btnJustConfirm" value="confirm" class="primary">Confirmar</button>
      </menu>
    </form>
  </dialog>

  <!-- Dialog Hist√≥rico da Atividade -->
  <dialog id="dlgHist">
    <form method="dialog" class="form">
      <h3>Hist√≥rico da Atividade</h3>
      <div class="filters" style="margin:8px 0 10px 0; grid-template-columns:1fr 1fr 1fr 1fr 1fr 1fr;">
        <div class="group"><label>De</label><input id="histStart" type="date"/></div>
        <div class="group"><label>At√©</label><input id="histEnd" type="date"/></div>
        <div class="group"><label>&nbsp;</label><button id="histApply" class="btn">Aplicar filtro</button></div>
      </div>
      <div id="histList" style="max-height:300px; overflow:auto; border:1px solid #e2e8f0; border-radius:10px; padding:8px; background:#f8fafc"></div>
      <menu>
        <button id="btnHistExport" class="btn">Exportar CSV</button>
        <button value="close" class="primary">Fechar</button>
      </menu>
    </form>
  </dialog>

  <div id="tooltip" class="tooltip hidden"></div>
  <script src="./app.js"></script>
  <script src="enhancer2.js"></script>
  <script src="planner_enhancer.js"></script>
</body>
</html>
